pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
function _init()

	coin_i={1,gen_anim({16,17,18,19},{4,3,3,3})}
	ply=player(0,50)
	plat={}
	
	scroll={0,0}
	
end

function _update()
	
	ply:update(plat)
	scroll[1]+=(ply.box.x1-scroll[1]-68)/10
	
	-- coin animation logic
	if coin_i[1] < #coin_i[2]then
		coin_i[1]+=1
	else
		coin_i[1]=1
	end
	
end

function _draw()
	cls()
	rectfill(0,0,127,127,12)
	
	--begin drawing of the map
	c_block=0 --curent block
	plat={}
	for y=0,16 do
		for x=0,70 do
			c_block=mget(x,y)
			if c_block ~= 0 then
				if c_block == 162 then
					spr(coin_i[2][coin_i[1]],x*8-scroll[1],y*8-1)
				else
					spr(c_block,x*8-scroll[1],y*8)
					add(plat,box(x*8,y*8,7,7))
				end
			end
		end
	end
	-- end drawing of the map
	
	ply:draw(scroll)
	
	rect(0,0,127,127,7)
end
-->8
-- helper functions

function box(x,y,w,h)
	return {
		x1=x,
		y1=y,
		x2=x+w,
		y2=y+h,
		h=h,
		w=h,
		update=function (self)
			self.x2=self.x1+w
			self.y2=self.y1+w
		end
	}
end

function coll(a,b)
	if a.y1 > b.y1+b.h then return false end
	if b.y1 > a.y1+a.h then return false end
	if a.x1 > b.x1+b.w then return false end
	if b.x1 > a.x1+a.w then return false end
	
	return true
end

function gen_anim(frames,duration)
	
	anim_frames={}
	for i,frame in pairs(frames) do
		for j=1,duration[i] do
			add(anim_frames,frame)
		end
	end
	
	return anim_frames
end

function coll_test(box,tiles)
	hit_list={}
	
	for i,tile in pairs(tiles) do
		if coll(box, tile) then
			add(hit_list,tile)
		end
	end
	
	return hit_list
	
end

function move(box,vel,tiles)
	coll_types={
		top=false,
		bottom=false,
		right=false,
		left=false
	}
	
	box.x1+=vel[1]
	box:update()
	hit_list=coll_test(box,tiles)
	for i,tile in pairs(hit_list) do
		if vel[1]>0 then
			box.x1=tile.x1-8
			coll_types.right=true
			box:update()
		elseif vel[1]<0 then
			box.x1=tile.x2+1
			coll_types.left=true
			box:update()
		end
	end	
	
	box.y1+=vel[2]
	box:update()
	hit_list=coll_test(box,tiles)
	for i,tile in pairs(hit_list) do
		if vel[2]>0 then
			box.y1=tile.y1-8
			coll_types.bottom=true
			box:update()
		elseif vel[2]<0 then
			box.y1=tile.y2+1
			coll_types.top=true
			box:update()
		end
	end
	
	return box,coll_types
end

-->8
-- objects

function player(x,y)
	return {
		box=box(x,y,7,7),
		vel={0,0},
		vs=0.25,
		max_vel=2,
		force=0.5,
		jumped=false,
		air⧗=0,
		
		--animation logic
		anim_i=0,
		anims={
			idle=gen_anim({1,2,3,4},{10,4,10,4}),
			walk=gen_anim({5,6,7,8},{3,3,3,3}),
			jump={9,10,11},
		},
		mode="idle",
		facing=false,
		
		update=function(self,plat)
		
			-- walking logic
			self.vel={0,0}
			if btn(1) then
				self.vel[1]+=2
			end
			
			if btn(0) then
				self.vel[1]-=2
			end
			
			if btn(4) and not self.jumped then
				if self.air⧗ < 10 then
					self.jumped=true
					self.force = -3.75
					self.mode="jump"
				end
			end
		
			self.vel[2] += self.force
			self.force+=0.25
			if self.force>7 then
				self.force=7
			end
			
			if self.vel[1]==0 and not self.jumped then
				self.mode="idle"
			elseif (self.vel[1]>0 or self.vel[1]<0) and not self.jumped then
				self.mode="walk"
			end
			
			-- collision logic
			self.box,col=move(self.box,self.vel,plat)
			
			if col.bottom then
				self.force=0
				self.jumped=false
				self.air⧗=0
			else
				self.air⧗+=1
			end
			
			if col.top then
				self.force=1
			end
			
			self.box:update()
		end,
		
		draw=function(self,scroll)
			--animation logic
			if self.anim_i<#self.anims[self.mode]-1 and self.mode~="jump"then
				self.anim_i+=1
			elseif self.mode=="jump" then
				if self.force<0 then
					self.anim_i=0
				elseif self.force==0then
					self.anim_i=1
				elseif self.force>0 then
					self.anim_i=2
				end
			else
				self.anim_i=0
			end
			if self.vel[1]>0 then
				self.facing=false
			elseif self.vel[1]<0 then
				self.facing=true
			end
			spr(self.anims[self.mode][self.anim_i+1],self.box.x1-scroll[1],self.box.y1,1,1,self.facing,false)
		end
	}
end
__gfx__
80000008444444444444444400000000000000004444444444444444000000004444444444444444444444444444444400000000000000000000000000000000
0800008044f4fff444444444444444444444444444f4fff444f4fff44444444444f4fff444f45f5444f45f5444f4fff400000000000000000000000000000000
008008004fff5f5044f45f5444f4fff444f4fff44fff5f504fff5f5044f4fff44fff5f504ffffff04fff5f504ffffff000000000000000000000000000000000
000080000ffffff04fff5f504fff5f504fff5f540ffffff00ffffff04fff5f500ffffff00ffffff00fff5f500fff5f5000000000000000000000000000000000
0008000000dddd000ffffff00ffffff04fff5f5000dddd0000dddd000ffffff000dddd0000dddd0000dddd0000dddd0000000000000000000000000000000000
008008000077770000dddd0000dddd00006666000077770000777700006666000077770000777700007777000077770000000000000000000000000000000000
08000080007777000077770000777700007777000077771000777710017777000177770000777700007777000077770000000000000000000000000000000000
80000008001001000010010000100100001001000010000001000000000000100000010000010010000100100001001000000000000000000000000000000000
00aaaa0000aaaa0000aaaa0000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaa7a00aaaa7a000aaa7000aaaa7a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa99a7a0aaa9a7000aaaa000aa9aa70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa99aaa0aaa9aa000aaaa000aa9aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa99aaa0aaa9aa000aaaa000aa9aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa99aaa0aaa9aa000aaaa000aa9aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaaaa00aaaaaa000aaaa000aaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaaa0000aaaa0000aaaa0000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000007700000000000000000000000000000000000007000000000000000000000000000000000000330000000
00000000000000000700000000000000000000000077770000000000000000000000000000000000007700000000000000000003300000000000003333000000
00000000000000007700000000000000000000000077777700000000000000000000000000000000007700000000000000000033330000000000033333300000
00000000000000077770000000000000000000000777777770000000000000000000000000000000077770000000000000000333333000000000333333330000
00000000000000777777000000000000000000000777777777000000000000000000000000000000777770000000000000000055550000000000055555500000
00000000000007777777700000000000000000000777777777700000000000000000000000000000777777000000000000003333333300000000333333330000
00000000000077777777700000000000000000007777777777770000000000000000000000000007777777000000000000033333333330000033333333333300
00000000000777777777770000000000000000007777777777777700000000000000000000000077777777000000000000033333333330000333333333333330
00000000007777777777770000000000000000077777777777777770000000000000000000000777777777000000000000000555555000000005555555555000
00000000077777777777777000000000000000667677777777777777000000000000000000000777777777700000000000033333333330000033333333333300
00000000667777777777766000000000000006666667766666777666600000000000000000007777777777700000000000333333333333000333333333333330
00000006666676666666666600000000000006666666666666666666666000000000000000077777777777700000000000333333333333003333333333333333
00000066666666666666666600000000000066666666666666666666666600000000000000067767777777770000000000000055550000000000005555000000
00000066666666666666666660000000000666666666666666666666666660000000000000666766666777770000000000000044440000000000004444000000
00000666666666666666666660000000000666666666666666666666666666000000000066666666666666660000000000000044440000000000004444000000
00006666666666666666666666000000006666666666666666666666666666606000000666666666666666666000000000000044440000000000004444000000
00066666666666666666666666000000006666666666666666666666666666666600666666666666666666666000000000000000000000000000000000033000
0066666666666666666666666660000006666666666666666666666666666666666666666666666666666666660000000000000000000f0000000f0003333330
00666666666666666666666666660000066666666666666666666666666666666666666666666666666666666600000000000f00000ff400000f040000555500
0666666666666666666666666666600006666666666666666666666666666666666666666666666666666666666000000000f40000f4f4000004f40033333333
66666666666666666666666666666600666666666666666666666666666666666666666666666666666666666666000000ff4400004444000004440005555550
666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666000004444000044440000f4440033333333
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000444400004444000044440000044000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666660000444400004444000044440000044000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600003300000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600003330330000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600003330333000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600003335333030000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666644453335333533000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666644453335333533300000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666644453333333333330000000000000000
00bbbbbbbbbbbbbbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb5bb5bbbb5bb5bbbbbb5bbbbbbbb5bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5b4b545bb545b4b5b55b45b5bb5b545b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
45454445544454545445445455454445000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444644444444644444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44446444464444444444444644644644000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
46444444444446444644444464444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444464444446444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444744444444444444777744444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444644447744644444464447777774444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44644444644474444446444447177174444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444447744444444447777774444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
46444444446447444444464444777744444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444644444464444644444444717146444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444446444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
888868884444444400aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88886888555555540aaaa7a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666666744444444aaa99a7a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8688888844455555aaa99aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8688888844444444aaa99aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666667744444445aaa99aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88886888555555540aaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
888868884444444400aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777770000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007711177007777700
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007717177077111770
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007711177077171770
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006777776077111770
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006666666067777760
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000666660006666600
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000a2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000080818282828283000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000080818182830000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8082828300000000000000808182828182818282818182818300000000000000000000000000000094949294940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9494949483000000000080949494949494949494909494949400000000808182818300000000000094949494940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9492949094818281828194909294949290909494909090949400000000949494949400000000000094909290900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9094949194949491949494949494929490929192949292949400000000949492949400000000000094949494940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9491949494949294949292949294929094949492929494949400000000949094949400000000000094909294940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9494949491949094949494949492949094949492929494949400000000949290909400000000000094949294940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9094949394949492929294929294949494949292949094919400000000949492949400000000000094929494940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9492949494909494919492929491929294949292929494909400000000949090949400000000000094909492940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9494909490949294949294949492929494949494949494949400000000949494909400000000000094949494940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00020000000000c0500d050000000f05012050000001505017050190501d050200502b050341502e1500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010200000c630080200561003210016100e6101860000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 41404344

